<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --primary: #ad1457; --bg: #fff5f8; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .karta { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 600px; text-align: center; }
        
        /* 3D SCÉNA */
        .scena-wrapper { background: #fff; border: 2px dashed #f9a8d4; border-radius: 20px; margin: 20px 0; padding: 40px 10px; display: flex; flex-direction: column; align-items: center; }
        .scena { height: 350px; perspective: 1000px; display: flex; align-items: center; justify-content: center; width: 100%; }
        .dort-telo { position: relative; width: 160px; transform-style: preserve-3d; transition: transform 0.1s linear; }

        /* VRSTVY - Dynamická výška z JS */
        .vrstva { position: absolute; width: 100%; transform-style: preserve-3d; bottom: var(--bottom); height: var(--h); }
        .segment { 
            position: absolute; width: var(--segW); height: var(--h); left: 50%; margin-left: calc(var(--segW)/-2); 
            background: linear-gradient(to right, rgba(0,0,0,0.12), transparent, rgba(0,0,0,0.12)), var(--color); 
        }
        
        /* VÍČKO - Sedí na vrcholu poslední vrstvy */
        .vicko { 
            position: absolute; width: var(--w); height: var(--w); background: var(--topColor); border-radius: 50%; 
            left: 50%; top: 50%; transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc(var(--h) / 2)); 
            transform-style: preserve-3d; 
        }

        /* OVOCE */
        .deco-3d { position: absolute; width: 28px; height: 35px; transform-style: preserve-3d; transform-origin: center bottom; }
        .deco-face { position: absolute; width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; transform-origin: bottom center; }
        .face-2 { transform: rotateY(90deg); }

        .sekce { background: #fffcfd; padding: 15px; border-radius: 15px; border: 1px solid #fce7f3; margin-bottom: 15px; text-align: left; }
        .tahlo { width: 80%; accent-color: var(--primary); cursor: pointer; margin-top: 20px; }
        select, input { padding: 8px; border-radius: 8px; border: 1px solid #f9a8d4; }
    </style>
</head>
<body>

<div class="karta">
    <h2 style="color:var(--primary)">Cakes by DT - 3D Náhled</h2>
    
    <div class="sekce">
        <label>Počet pater:</label>
        <select id="patra" onchange="kresliDort()">
            <option value="1">1 patro</option>
            <option value="2">2 patra</option>
            <option value="3" selected>3 patra</option>
            <option value="4">4 patra</option>
        </select>
    </div>

    <div class="scena-wrapper">
        <div class="scena"><div class="dort-telo" id="vizual"></div></div>
        <input type="range" min="0" max="360" value="45" class="tahlo" oninput="otoc(this.value)">
    </div>
</div>

<script>
    let rotY = 45;
    const strawberrySVG = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><path d="M50,115 C20,115 5,85 5,55 C5,25 25,10 50,10 C75,10 95,25 95,55 C95,85 80,115 50,115 Z" fill="%23ff4d4d"/><path d="M50,15 L35,-5 L50,5 L65,-5 Z" fill="%232e7d32"/></svg>')`;

    function otoc(v) {
        rotY = v;
        document.getElementById('vizual').style.transform = `rotateX(-20deg) rotateY(${v}deg)`;
    }

    function kresliDort() {
        const plocha = document.getElementById('vizual');
        const pCount = parseInt(document.getElementById('patra').value);
        plocha.innerHTML = "";

        const sirka = 160;
        let aktualniVyska = 0;
        
        // i jsou jednotlivé vrstvy (korpus + krém)
        // Pro 3 patra korpusu potřebujeme 2 vrstvy krému mezi ně + 1 krém na vrchu
        const pocetVrstev = pCount * 2; 

        for (let i = 0; i < pocetVrstev; i++) {
            const jeKorpus = (i % 2 === 0);
            const vyskaVrstvy = jeKorpus ? 30 : 10; // Korpus 4.5cm (30px), Krém 1.5cm (10px)
            const barva = jeKorpus ? "#f3e5ab" : "#f8bbd0";

            const v = document.createElement('div');
            v.className = 'vrstva';
            v.style.setProperty('--h', vyskaVrstvy + 'px');
            v.style.setProperty('--bottom', aktualniVyska + 'px');
            v.style.setProperty('--color', barva);
            v.style.setProperty('--segW', (Math.PI * sirka / 32 + 2) + 'px');

            for (let j = 0; j < 32; j++) {
                const s = document.createElement('div');
                s.className = 'segment';
                s.style.transform = `rotateY(${j * 11.25}deg) translateZ(${sirka/2}px)`;
                v.appendChild(s);
            }

            // Horní víčko a jahody dáváme jen na úplně poslední vrstvu krému
            if (i === pocetVrstev - 1) {
                const vicko = document.createElement('div');
                vicko.className = 'vicko';
                vicko.style.setProperty('--w', sirka + 'px');
                vicko.style.setProperty('--topColor', barva);
                
                // Rozmístění jahod
                const r = sirka / 3.5;
                [[0,0], [r,0], [-r,0], [0,r], [0,-r]].forEach(pos => {
                    const d = document.createElement('div');
                    d.className = 'deco-3d';
                    d.style.left = (sirka/2 + pos[0] - 14) + 'px';
                    d.style.top = (sirka/2 + pos[1] - 17.5) + 'px';
                    // Jahoda sedí na vrchu (vyskaVrstvy/2 + kousek)
                    d.style.transform = `rotateX(-90deg) translateZ(2px)`;
                    
                    const f1 = document.createElement('div');
                    f1.className = 'deco-face';
                    f1.style.backgroundImage = strawberrySVG;
                    const f2 = document.createElement('div');
                    f2.className = 'deco-face face-2';
                    f2.style.backgroundImage = strawberrySVG;
                    
                    d.appendChild(f1); d.appendChild(f2);
                    vicko.appendChild(d);
                });
                v.appendChild(vicko);
            }

            plocha.appendChild(v);
            aktualniVyska += vyskaVrstvy; // Přičteme výšku pro další vrstvu
        }
        otoc(rotY);
    }

    window.onload = kresliDort;
</script>

</body>
</html>
