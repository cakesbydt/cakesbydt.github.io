<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Pro 3D Konfigurátor | Cakes by DT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --primary: #ad1457; --bg: #fff5f8; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; }
        .hlavni-wrapper { display: flex; width: 1200px; background: white; margin: 40px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); overflow: hidden; }
        .obsah { flex: 1; padding: 40px; display: flex; flex-direction: column; }
        #canvas-container { width: 100%; height: 450px; background: #fff; border-radius: 20px; border: 2px solid var(--bg); cursor: grab; }
        .ovladani { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        select { padding: 12px; border-radius: 10px; border: 1px solid #ddd; width: 100%; font-family: inherit; }
        label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #666; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div class="hlavni-wrapper">
    <div class="obsah">
        <h1>3D Konfigurátor (WebGL Edition)</h1>
        
        <div class="ovladani">
            <div>
                <label>Typ korpusu</label>
                <select id="korpus" onchange="updateCake()">
                    <option value="0x4e342e">Čokoládový</option>
                    <option value="0xf3e5ab">Světlý</option>
                    <option value="0xd32f2f">Red Velvet</option>
                </select>
            </div>
            <div>
                <label>Ovoce (Skutečné 3D)</label>
                <select id="ovoce" onchange="updateCake()">
                    <option value="none">Žádné</option>
                    <option value="strawberry">Jahody</option>
                    <option value="blueberry">Borůvky</option>
                    <option value="mix">Mix ovoce</option>
                </select>
            </div>
            <div>
                <label>Počet pater</label>
                <select id="patra" onchange="updateCake()">
                    <option value="1">1 patro</option>
                    <option value="2">2 patra</option>
                    <option value="3">3 patra</option>
                </select>
            </div>
        </div>

        <div id="canvas-container"></div>
        <p style="text-align: center; color: #aaa; font-size: 12px; margin-top: 10px;">Dortem můžete otáčet tahem myši</p>
        
        <button class="btn">ODESLAT POPTÁVKU</button>
    </div>
</div>

<script>
    let scene, camera, renderer, cakeGroup;
    const container = document.getElementById('canvas-container');

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xffffff);

        camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        // Světla
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7);
        light.castShadow = true;
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff, 0.6));

        cakeGroup = new THREE.Group();
        scene.add(cakeGroup);

        updateCake();
        animate();
    }

    function updateCake() {
        while(cakeGroup.children.length > 0) cakeGroup.remove(cakeGroup.children[0]);

        const korpusColor = parseInt(document.getElementById('korpus').value);
        const ovoceTyp = document.getElementById('ovoce').value;
        const patra = parseInt(document.getElementById('patra').value);

        // Vykreslení pater
        for(let p = 0; p < patra; p++) {
            const radius = 2.5 - (p * 0.5);
            const yPos = p * 1.2;

            // Korpus
            const geo = new THREE.CylinderGeometry(radius, radius, 1, 32);
            const mat = new THREE.MeshPhongMaterial({ color: korpusColor });
            const cylinder = new THREE.Mesh(geo, mat);
            cylinder.position.y = yPos;
            cylinder.castShadow = true;
            cakeGroup.add(cylinder);

            // Krém (bílý proužek)
            const creamGeo = new THREE.CylinderGeometry(radius + 0.01, radius + 0.01, 0.2, 32);
            const creamMat = new THREE.MeshPhongMaterial({ color: 0xffffff });
            const cream = new THREE.Mesh(creamGeo, creamMat);
            cream.position.y = yPos + 0.2;
            cakeGroup.add(cream);

            // Přidání ovoce pouze na nejvyšší patro
            if (p === patra - 1 && ovoceTyp !== "none") {
                addFruit(radius, yPos + 0.5, ovoceTyp);
            }
        }
    }

    function addFruit(radius, y, type) {
        const count = 10;
        for(let i = 0; i < count; i++) {
            let fruit;
            const currentType = type === 'mix' ? (i % 2 === 0 ? 'strawberry' : 'blueberry') : type;

            if(currentType === 'strawberry') {
                // Skutečný 3D jehlan (jahoda)
                fruit = new THREE.Mesh(
                    new THREE.ConeGeometry(0.15, 0.3, 8),
                    new THREE.MeshPhongMaterial({ color: 0xff1744 })
                );
            } else {
                // Skutečná 3D koule (borůvka)
                fruit = new THREE.Mesh(
                    new THREE.SphereGeometry(0.12, 16, 16),
                    new THREE.MeshPhongMaterial({ color: 0x3f51b5 })
                );
            }

            const angle = (i / count) * Math.PI * 2;
            const dist = radius * 0.7;
            fruit.position.set(Math.cos(angle) * dist, y + 0.15, Math.sin(angle) * dist);
            fruit.rotation.x = Math.random();
            cakeGroup.add(fruit);
        }
    }

    // Interakce (otáčení)
    let isDragging = false;
    let previousMouseX = 0;
    container.onmousedown = () => isDragging = true;
    window.onmouseup = () => isDragging = false;
    window.onmousemove = (e) => {
        if(isDragging) {
            cakeGroup.rotation.y += (e.clientX - previousMouseX) * 0.01;
        }
        previousMouseX = e.clientX;
    };

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    window.onload = init;
</script>
</body>
</html>
