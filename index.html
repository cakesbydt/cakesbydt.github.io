<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cakes by DT | Premium Configurator</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --accent: #bc9bc2;
            --gold: #d4af37;
            --bg: #fdfbfd;
            --card-bg: #ffffff;
            --text: #2d2d2d;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            width: 100%;
            max-width: 1600px;
            padding: 40px;
            min-height: 100vh;
        }

        @media (max-width: 1200px) {
            .app-container { grid-template-columns: 1fr; }
        }

        /* 3D Visualizer Section */
        .visualizer-card {
            background: white;
            border-radius: 40px;
            position: sticky;
            top: 40px;
            height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        #canvas-container { flex: 1; cursor: grab; background: radial-gradient(circle at center, #ffffff 0%, #f3f3f3 100%); }

        /* Configuration Form Section */
        .config-panel { padding-right: 20px; }
        
        .step-card {
            background: white;
            padding: 35px;
            border-radius: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            border: 1px solid #f0f0f0;
        }

        h2 { font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 30px; color: var(--accent); }
        h3 { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: #aaa; margin-bottom: 20px; }

        /* Grid Selection UI */
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .option-item {
            border: 2px solid #f0f0f0;
            padding: 15px;
            border-radius: 18px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
            font-size: 14px;
        }

        .option-item:hover { border-color: var(--accent); background: #fdf9ff; }
        .option-item.active { border-color: var(--accent); background: var(--accent); color: white; box-shadow: 0 10px 20px rgba(188, 155, 194, 0.3); }

        /* Price Tag */
        .price-badge {
            position: absolute;
            top: 30px;
            right: 30px;
            background: #1a1a1a;
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 20px;
            z-index: 10;
        }

        /* Order Sidebar / Floating Summary */
        .summary-box {
            background: #1a1a1a;
            color: white;
            padding: 30px;
            border-radius: 30px;
            position: sticky;
            top: 40px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #333;
            font-size: 14px;
            opacity: 0.8;
        }

        .submit-btn {
            width: 100%;
            padding: 22px;
            background: var(--gold);
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 25px;
            transition: 0.4s;
        }

        .submit-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(212, 175, 55, 0.4); }

        input[type="text"], input[type="email"], input[type="tel"], input[type="date"], textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            border: 1px solid #ddd;
            font-family: inherit;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

<form id="orderForm" class="app-container">
    <div class="config-panel">
        <h1 style="font-family: 'Playfair Display', serif; font-size: 48px; margin-bottom: 10px;">Váš vysněný dort</h1>
        <p style="margin-bottom: 40px; opacity: 0.6;">Navrhněte si design a my ho přivedeme k životu.</p>

        <div class="step-card">
            <h3>1. Velikost a Tvar</h3>
            <div class="option-grid" id="grid-diameter">
                <div class="option-item" data-val="15">15 cm (6-8 porcí)</div>
                <div class="option-item active" data-val="20">20 cm (10-12 porcí)</div>
                <div class="option-item" data-val="24">24 cm (15-18 porcí)</div>
            </div>
            
            <h3>Patra / Výška</h3>
            <div class="option-grid" id="grid-layers">
                <div class="option-item" data-val="4">Standard (4 vrstvy)</div>
                <div class="option-item active" data-val="6">Vysoký (6 vrstev)</div>
                <div class="option-item" data-val="10">Double (10 vrstev)</div>
            </div>
        </div>

        <div class="step-card">
            <h3>2. Příchutě a Design</h3>
            <label>Korpus</label>
            <div class="option-grid" id="grid-flavor">
                <div class="option-item active" data-val="0x6e5445" data-name="Čokoládový">Čokoláda</div>
                <div class="option-item" data-val="0xfff1a3" data-name="Vanilkový">Vanilka</div>
                <div class="option-item" data-val="0x3b7a31" data-name="Mechový">Mechový</div>
                <div class="option-item" data-val="0xeba254" data-name="Mrkvový">Mrkvový</div>
            </div>

            <label>Styl obmazu</label>
            <div class="option-grid" id="grid-coat">
                <div class="option-item active" data-val="naked">Nahý</div>
                <div class="option-item" data-val="semi">Polonahý</div>
                <div class="option-item" data-val="full">Plný obmaz</div>
            </div>
        </div>

        <div class="step-card">
            <h3>3. Ovoce a Náplň</h3>
            <label>Ovoce uvnitř</label>
            <div class="option-grid" id="grid-fruit-in">
                <div class="option-item active" data-val="mix">Mix ovoce</div>
                <div class="option-item" data-val="strawberries">Jahody</div>
                <div class="option-item" data-val="raspberries">Maliny</div>
                <div class="option-item" data-val="none">Bez ovoce</div>
            </div>
        </div>

        <div class="step-card">
            <h3>4. Kontaktní údaje</h3>
            <input type="text" name="user_name" placeholder="Celé jméno" required>
            <div style="display: flex; gap: 10px;">
                <input type="email" name="user_email" placeholder="E-mail" required>
                <input type="tel" name="user_phone" placeholder="Telefon" required>
            </div>
            <input type="date" name="order_date" required title="Datum vyzvednutí">
            <textarea name="notes" rows="3" placeholder="Poznámky k objednávce (nápisy, alergie, barvy...)"></textarea>
        </div>
    </div>

    <div class="visual-panel">
        <div class="visualizer-card">
            <div class="price-badge" id="price-tag">--- Kč</div>
            <div id="canvas-container"></div>
            
            <div class="summary-box">
                <h2 style="color: white; margin-top: 0; font-size: 24px;">Shrnutí objednávky</h2>
                <div id="summary-list">
                    </div>
                <button type="submit" class="submit-btn">Odeslat poptávku</button>
                <p style="font-size: 11px; opacity: 0.5; text-align: center; margin-top: 15px;">* Cena je orientační, finální kalkulaci pošleme do 24h.</p>
            </div>
        </div>
    </div>

    <input type="hidden" name="config_summary" id="hiddenSummary">
    <input type="hidden" name="total_price" id="hiddenPrice">
</form>

<script>
    // Konfigurace barev a cen
    let config = {
        diameter: 20,
        layers: 6,
        flavor: '0x6e5445',
        flavorName: 'Čokoládový',
        coat: 'naked',
        fruitIn: 'mix'
    };

    // Inicializace EmailJS
    (function() { emailjs.init("YOUR_PUBLIC_KEY"); })();

    // --- THREE.JS LOGIKA ---
    let scene, camera, renderer, cakeGroup;
    const container = document.getElementById('canvas-container');

    function init3D() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 5, 12);
        camera.lookAt(0, 2, 0);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        const ambient = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambient);
        const light = new THREE.PointLight(0xffffff, 0.8);
        light.position.set(10, 10, 10);
        scene.add(light);

        cakeGroup = new THREE.Group();
        scene.add(cakeGroup);

        // Stojan na dort
        const standGeo = new THREE.CylinderGeometry(4, 4.2, 0.2, 32);
        const standMat = new THREE.MeshPhongMaterial({ color: 0xffffff });
        const stand = new THREE.Mesh(standGeo, standMat);
        stand.position.y = -0.1;
        scene.add(stand);

        updateCake();
        animate();
    }

    function updateCake() {
        while(cakeGroup.children.length > 0) cakeGroup.remove(cakeGroup.children[0]);
        
        const r = config.diameter / 7;
        const h = 0.4;
        
        for(let i=0; i<config.layers; i++) {
            const isCream = i % 2 === 1;
            const geo = new THREE.CylinderGeometry(r, r, h, 64);
            const mat = new THREE.MeshPhongMaterial({ color: isCream ? 0xfff9e6 : parseInt(config.flavor) });
            const segment = new THREE.Mesh(geo, mat);
            segment.position.y = i * h + (h/2);
            cakeGroup.add(segment);

            if(config.coat !== 'naked') {
                const cGeo = new THREE.CylinderGeometry(r + 0.05, r + 0.05, h, 64, 1, true);
                const cMat = new THREE.MeshPhongMaterial({ 
                    color: 0xffffff, 
                    transparent: true, 
                    opacity: config.coat === 'semi' ? 0.4 : 1,
                    side: THREE.DoubleSide 
                });
                const coat = new THREE.Mesh(cGeo, cMat);
                coat.position.y = segment.position.y;
                cakeGroup.add(coat);
            }
        }
        updateUI();
    }

    function updateUI() {
        // Výpočet ceny
        let price = (config.diameter * 20) + (config.layers * 50);
        if(config.coat === 'full') price += 150;
        
        document.getElementById('price-tag').innerText = `${price} Kč`;
        document.getElementById('hiddenPrice').value = price + " Kč";

        // Shrnutí
        const summaryHtml = `
            <div class="summary-item"><span>Průměr:</span><span>${config.diameter} cm</span></div>
            <div class="summary-item"><span>Vrstvy:</span><span>${config.layers}</span></div>
            <div class="summary-item"><span>Korpus:</span><span>${config.flavorName}</span></div>
            <div class="summary-item"><span>Obmaz:</span><span>${config.coat}</span></div>
            <div class="summary-item"><span>Ovoce:</span><span>${config.fruitIn}</span></div>
        `;
        document.getElementById('summary-list').innerHTML = summaryHtml;
        document.getElementById('hiddenSummary').value = `Dort ${config.diameter}cm, ${config.layers} vrstev, korpus ${config.flavorName}, obmaz ${config.coat}`;
    }

    function animate() {
        requestAnimationFrame(animate);
        cakeGroup.rotation.y += 0.005;
        renderer.render(scene, camera);
    }

    // --- LOGIKA KLIKÁNÍ NA MOŽNOSTI ---
    document.querySelectorAll('.option-item').forEach(item => {
        item.addEventListener('click', function() {
            const parent = this.parentElement.id;
            const val = this.getAttribute('data-val');
            
            // Aktivní stav v UI
            this.parentElement.querySelectorAll('.option-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');

            // Update dat
            if(parent === 'grid-diameter') config.diameter = parseInt(val);
            if(parent === 'grid-layers') config.layers = parseInt(val);
            if(parent === 'grid-flavor') {
                config.flavor = val;
                config.flavorName = this.getAttribute('data-name');
            }
            if(parent === 'grid-coat') config.coat = val;
            if(parent === 'grid-fruit-in') config.fruitIn = val;

            updateCake();
        });
    });

    window.onload = init3D;

    // EmailJS odeslání
    document.getElementById('orderForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = this.querySelector('.submit-btn');
        btn.innerText = "Odesílám...";
        
        emailjs.sendForm('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', this)
            .then(() => {
                alert('Děkujeme! Ozveme se vám s potvrzením.');
                btn.innerText = "Odesláno!";
            }, (err) => {
                alert('Chyba při odesílání. Zkuste to prosím znovu.');
                btn.innerText = "Zkusit znovu";
            });
    });
</script>

</body>
</html>
